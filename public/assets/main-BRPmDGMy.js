import"./modulepreload-polyfill-B5Qt9EMX.js";document.addEventListener("DOMContentLoaded",i=>{const s=document.getElementById("loginForm"),t=new URLSearchParams(window.location.search).get("room");if(t){const e=document.createElement("input");e.type="hidden",e.name="room",e.value=t,s.appendChild(e),console.log("Room parameter detected:",t)}fetch("/getSession").then(e=>e.json()).then(e=>{e.loggedin&&(t?window.location.href=`game.html?room=${t}`:window.location.href="game.html")}),s.addEventListener("submit",async e=>{e.preventDefault();const r=document.getElementById("username").value,l=document.getElementById("password").value;try{const n=await fetch("/auth",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({username:r,password:l,room:t})}),o=await n.json();if(n.ok&&o.success)o.room?window.location.href=`game.html?room=${o.room}`:window.location.href="game.html";else{const a=document.getElementById("errorMessage");a.textContent=o.message||"Login failed",a.style.display="block"}}catch(n){console.error("Error al realizar el login:",n)}})});document.addEventListener("DOMContentLoaded",()=>{const i=document.getElementById("loginForm"),s=document.getElementById("registerForm"),d=document.getElementById("formTitle");document.getElementById("toggleForm");const t=document.getElementById("showRegister"),e=document.getElementById("errorMessage");t.addEventListener("click",r=>{r.preventDefault(),s.style.display==="none"?(i.style.display="none",s.style.display="block",d.textContent="Registro",t.textContent="¿Ya tienes cuenta? Inicia sesión"):(i.style.display="block",s.style.display="none",d.textContent="Login",t.textContent="¿No tienes cuenta? Regístrate"),e.style.display="none"}),i.addEventListener("submit",async r=>{r.preventDefault();const l=document.getElementById("username").value,n=document.getElementById("password").value;try{const o=await fetch("/auth",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({username:l,password:n})}),a=await o.json();o.ok&&a.success?window.location.href="game.html":(e.textContent=a.message||"Login fallido",e.style.display="block")}catch(o){console.error("Error al realizar el login:",o)}}),s.addEventListener("submit",async r=>{r.preventDefault();const l=document.getElementById("regUsername").value,n=document.getElementById("regPassword1").value,o=document.getElementById("regPassword2").value;if(n!==o){e.textContent="Las contraseñas no coinciden",e.style.display="block",setTimeout(()=>{e.style.display="none"},3e3);return}const a=n;try{const c=await fetch("/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,password:a})});if(c.ok)alert("Usuario registrado exitosamente. Ahora puedes iniciar sesión."),i.style.display="block",s.style.display="none",d.textContent="Login",t.textContent="¿No tienes cuenta? Regístrate";else{const m=await c.text();e.textContent=m||"Error al registrar usuario",e.style.display="block",setTimeout(()=>{e.style.display="none"},3e3)}}catch(c){console.error("Error al registrar usuario:",c)}})});
